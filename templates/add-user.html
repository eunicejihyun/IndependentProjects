{% block content %}
{% include "header.html" %}
{% set field_size = 33 %}

<div class="container">
    <div class="row main-row">

        <!--MENU-->
        <div class="col-md-7 left-side">
            {% include "menu.html" %}
        </div>

        <!--RIGHT SIDE-->
        <div class="col-md-5 right-side">
            {% include "navbar.html" %}

            <!--CONTENT-->
            <h1 class="right-heading">
                SETTINGS
                <span class="right-subheading">Add/Edit User</span>
            </h1>

            <div class="user-form">

                {% if 'add' in url_for(request.endpoint): %}
                <form action="{{ url_for('add_user') }}" method="POST" novalidate>
                    {% else: %}
                    {% set id = request.args.get("user_id") %}
                    <form action="{{ url_for('edit_user', user_id=id) }}" method="POST" novalidate>
                        {% endif %}
                        {{ form.csrf_token }}

                        <table>
                            <tr>
                                <td class="form-label">First Name</td>
                                <td class="form-field">
                                    {{ form.first_name(size=field_size, placeholder='Lin-Manuel') }}
                                </td>
                            </tr>
                            <tr>
                                <td class="form-label">Last Name</td>
                                <td class="form-field">
                                    {{ form.last_name(size=field_size, placeholder='Miranda') }}
                                </td>
                            </tr>
                            <tr>
                                <td class="form-label">Email</td>
                                <td class="form-field">
                                    {{ form.email(size=field_size, placeholder='lmm@mail.com') }}
                                </td>
                            </tr>
                            <tr>
                                <td class="form-label">Password</td>
                                <td class="form-field">
                                    {{ form.password(size=field_size) }}
                                </td>
                            </tr>
                            <tr>
                                <td class="form-label">Role</td>
                                <td class="form-field">
                                    {{ form.role() }}
                                </td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>
                                    <!--SUBMIT BUTTON-->
                                    {{ form.submit }}
                                </td>
                            </tr>

                            <tr>
                                <td></td>
                                <td>

                                    {% for err in form.first_name.errors %}
                                    <p class="form-error-msg">First Name - {{ err }}</p>
                                    {% endfor %}
                                    {% for err in form.last_name.errors %}
                                    <p class="form-error-msg">Last Name - {{ err }}</p>
                                    {% endfor %}
                                    {% for err in form.email.errors %}
                                    <p class="form-error-msg">Email - {{ err }}</p>
                                    {% endfor %}
                                    {% for err in form.password.errors %}
                                    <p class="form-error-msg">Password - {{ err }}</p>
                                    {% endfor %}
                                    {% for err in form.role.errors %}
                                    <p class="form-error-msg">Role - {{ err }}</p>
                                    {% endfor %}

                                    <!--FLASH MESSAGES-->
                                    {% with messages = get_flashed_messages() %}
                                    {% if messages %}
                                    <span class="flashes">
                                        {% for message in messages %}
                                        <p class="flash-msg">{{ message }}</p>
                                        {% endfor %}
                                    </span>
                                    {% endif %}
                                    {% endwith %}
                                    <!-- END FLASH MESSAGES-->

                                </td>
                            </tr>
                        </table>

                    </form>
            </div>

            <div class="current-data user-list">
                <h3>
                    Current Users
                </h3>
                <ol class="current-data-list">
                    {% for x in users: %}
                    <li>
                        {{x.first_name}} {{x.last_name}} - {{x.role.name}}
                        {% if x.id != 1: %}
                        <a class="menu-buttons remove-button" href="{{url_for('remove_user', user_id=x.id)}}">
                            <i class="fas fa-times-circle"></i>
                        </a>
                        {% endif %}
                        <a class="menu-buttons edit-button" href="{{url_for('edit_user', user_id=x.id)}}">
                            <i class="fas fa-pencil-alt"></i>
                        </a>
                    </li>
                    {% endfor %}
                </ol>
            </div>

            <a class="next-page" href="{{ url_for('add_table') }}">
                <button class="btn next-btn" type="button">
                    Add Tables
                    <i class="fas fa-angle-double-right"></i>
                </button>
            </a>
            <!--END CONTENT-->


        </div>
    </div>
</div>
{% endblock %}